<?php
bolt_decrypt( __FILE__ , '5eFSUx'); return 0;
##!!!##DQoNCg0KbmFtZXNwYWNlIEFwcFxSZXBvc2l0b3JpZXNcQWRtaW5cUGhpc2hpbmc7DQoNCnVzZSBBcHBcSGVscGVyc1xIZWxwZXI7DQp1c2UgQXBwXEludGVyZmFjZXNcQWRtaW5cUGhpc2hpbmdcUGhpc2hpbmdXZWJzaXRlSW50ZXJmYWNlOw0KdXNlIEFwcFxNb2RlbHNcUGhpc2hpbmdDYXRlZ29yeTsNCnVzZSBBcHBcTW9kZWxzXFBoaXNoaW5nRG9tYWluczsNCnVzZSBBcHBcTW9kZWxzXFBoaXNoaW5nV2Vic2l0ZVBhZ2U7DQp1c2UgQXBwXFNlcnZpY2VzXENvbXBsZXRlV2ViU2NyYXBlclNlcnZpY2U7DQp1c2UgQXBwXFRyYWl0c1xVcG9sYWRGaWxlVHJhaXQ7DQp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcQ2FjaGU7DQp1c2UgSWxsdW1pbmF0ZVxIdHRwXFJlcXVlc3Q7DQp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcREI7DQp1c2UgSWxsdW1pbmF0ZVxTdXBwb3J0XEZhY2FkZXNcU3RvcmFnZTsNCnVzZSBJbGx1bWluYXRlXFN1cHBvcnRcRmFjYWRlc1xWYWxpZGF0b3I7DQp1c2UgSWxsdW1pbmF0ZVxWYWxpZGF0aW9uXFJ1bGU7DQoNCmNsYXNzIFBoaXNoaW5nV2Vic2l0ZVJlcG9zaXRvcnkgaW1wbGVtZW50cyBQaGlzaGluZ1dlYnNpdGVJbnRlcmZhY2UNCnsNCiAgICB1c2UgVXBvbGFkRmlsZVRyYWl0Ow0KDQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2V0QWxsKCkNCiAgICB7DQoNCiAgICAgICAgaWYgKCFhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvbignd2Vic2l0ZS5saXN0JykpIHsNCiAgICAgICAgICAgIC8vIGVudGVyIGhlcmUgYnV0IGRpZG50IGFib3J0IGFuZCByZXR1cm4gd2hpdGUgcGFnZQ0KICAgICAgICAgICAgYWJvcnQoNDAzLCAnVW5hdXRob3JpemVkIGFjdGlvbi4nKTsNCiAgICAgICAgfQ0KDQogICAgICAgICR3ZWJzaXRlcyA9IFBoaXNoaW5nV2Vic2l0ZVBhZ2U6OndpdGhvdXRUcmFzaGVkKCktPndpdGgoJ2NhdGVnb3J5JyktPm9yZGVyQnkoJ2NyZWF0ZWRfYXQnLCAnZGVzYycpLT5nZXQoKTsNCiAgICAgICAgJGNhdGVnb3JpZXMgPSBQaGlzaGluZ0NhdGVnb3J5OjphbGwoKTsNCiAgICAgICAgJGRvbWFpbnMgPSBQaGlzaGluZ0RvbWFpbnM6OndpdGhvdXRUcmFzaGVkKCktPmdldCgpOw0KDQogICAgICAgICRicmVhZGNydW1icyA9IFsNCiAgICAgICAgICAgIFsnbGluaycgPT4gcm91dGUoJ2FkbWluLmRhc2hib2FyZCcpLCAnbmFtZScgPT4gX18oJ2xvY2FsZS5EYXNoYm9hcmQnKV0sDQogICAgICAgICAgICBbJ25hbWUnID0+IF9fKCdwaGlzaGluZy5waGlzaGluZycpXSwNCiAgICAgICAgICAgIFsnbmFtZScgPT4gX18oJ3BoaXNoaW5nLndlYnNpdGVzJyldDQogICAgICAgIF07DQoNCiAgICAgICAgcmV0dXJuIHZpZXcoJ2FkbWluLmNvbnRlbnQucGhpc2hpbmcud2Vic2l0ZXMuaW5kZXgnLCBjb21wYWN0KCdicmVhZGNydW1icycsICdkb21haW5zJywgJ3dlYnNpdGVzJywgJ2NhdGVnb3JpZXMnKSk7DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIHN0b3JlKFJlcXVlc3QgJHJlcXVlc3QpDQogICAgew0KICAgICAgICAkdmFsaWRhdG9yID0gVmFsaWRhdG9yOjptYWtlKCRyZXF1ZXN0LT5hbGwoKSwgWw0KICAgICAgICAgICAgJ2NvdmVyJyA9PiBbJ3JlcXVpcmVkJywgJ2ltYWdlJywgJ21pbWVzOmpwZyxqcGVnLHBuZycsICdtYXg6MjA0OCddLA0KICAgICAgICAgICAgJ3BoaXNoaW5nX2NhdGVnb3J5X2lkJyA9PiBbJ3JlcXVpcmVkJ10sDQogICAgICAgICAgICAnaHRtbF9jb2RlJyA9PiAncmVxdWlyZWRfd2l0aG91dDp3ZWJzaXRlX3VybCcsDQogICAgICAgICAgICAnd2Vic2l0ZV91cmwnID0+ICdyZXF1aXJlZF93aXRob3V0Omh0bWxfY29kZScsDQogICAgICAgICAgICAnc3BhX2h0bWxfY29kZScgPT4gJ251bGxhYmxlfHN0cmluZycsDQogICAgICAgICAgICAnaXNfc3BhJyA9PiAnbnVsbGFibGV8Ym9vbGVhbicsDQogICAgICAgICAgICAndHlwZScgPT4gJ3JlcXVpcmVkJywNCiAgICAgICAgICAgICdmcm9tX2FkZHJlc3NfbmFtZScgPT4gJ3JlcXVpcmVkfHN0cmluZ3xtYXg6MTAwJywNCiAgICAgICAgICAgICdkb21haW5faWQnID0+ICdyZXF1aXJlZF9pZjp0eXBlLG1hbmFnZWQnLA0KDQogICAgICAgICAgICAnZG93bmxvYWRfY3NzJyA9PiAnbnVsbGFibGV8Ym9vbGVhbicsDQogICAgICAgICAgICAnZG93bmxvYWRfaW1hZ2VzJyA9PiAnbnVsbGFibGV8Ym9vbGVhbicsDQogICAgICAgICAgICAnZG93bmxvYWRfanMnID0+ICdudWxsYWJsZXxib29sZWFuJywNCiAgICAgICAgICAgICdkb3dubG9hZF9mb250cycgPT4gJ251bGxhYmxlfGJvb2xlYW4nLA0KICAgICAgICAgICAgJ2Rvd25sb2FkX2pzb24nID0+ICdudWxsYWJsZXxib29sZWFuJywNCiAgICAgICAgICAgICdkb3dubG9hZF9vdGhlcl9hc3NldHMnID0+ICdudWxsYWJsZXxib29sZWFuJywNCiAgICAgICAgXSk7DQoNCiAgICAgICAgaWYgKCRyZXF1ZXN0LT50eXBlID09ICdvd24nKSB7DQogICAgICAgICAgICAkcmVxdWVzdC0+dmFsaWRhdGUoWw0KICAgICAgICAgICAgICAgICduYW1lJyA9PiBbJ3JlcXVpcmVkJywgJ21heDoyMDAnLCAndW5pcXVlOnBoaXNoaW5nX3dlYnNpdGVfcGFnZXMsbmFtZSddLA0KICAgICAgICAgICAgICAgICdmcm9tX2FkZHJlc3NfbmFtZScgPT4gJ2VtYWlsJw0KICAgICAgICAgICAgXSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkcmVxdWVzdC0+dmFsaWRhdGUoWw0KICAgICAgICAgICAgICAgICdmcm9tX2FkZHJlc3NfbmFtZScgPT4gWw0KICAgICAgICAgICAgICAgICAgICAncmVnZXg6L15bXkBdKyQvJw0KICAgICAgICAgICAgICAgIF0sDQogICAgICAgICAgICAgICAgJ25hbWUnID0+IFsNCiAgICAgICAgICAgICAgICAgICAgJ3JlcXVpcmVkJywNCiAgICAgICAgICAgICAgICAgICAgJ21heDoyMDAnLA0KICAgICAgICAgICAgICAgICAgICBSdWxlOjp1bmlxdWUoJ3BoaXNoaW5nX3dlYnNpdGVfcGFnZXMnLCAnbmFtZScpLT53aGVyZShmdW5jdGlvbiAoJHF1ZXJ5KSB1c2UgKCRyZXF1ZXN0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHF1ZXJ5LT53aGVyZSgnZG9tYWluX2lkJywgJHJlcXVlc3QtPmRvbWFpbl9pZCk7DQogICAgICAgICAgICAgICAgICAgIH0pLA0KICAgICAgICAgICAgICAgIF0sDQogICAgICAgICAgICBdKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICgkdmFsaWRhdG9yLT5mYWlscygpKSB7DQogICAgICAgICAgICAkZXJyb3JzID0gJHZhbGlkYXRvci0+ZXJyb3JzKCktPnRvQXJyYXkoKTsNCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsNCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwNCiAgICAgICAgICAgICAgICAnZXJyb3JzJyA9PiAkZXJyb3JzLA0KICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiBfXygnbG9jYWxlLlRoZXJlV2FzQVByb2JsZW1BZGRpbmdjYXRlZ29yeScpIC4gIjxicj4iIC4gX18oJ2xvY2FsZS5WYWxpZGF0aW9uIGVycm9yJyksDQogICAgICAgICAgICBdLCA0MjIpOw0KICAgICAgICB9DQoNCiAgICAgICAgREI6OmJlZ2luVHJhbnNhY3Rpb24oKTsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgIGlmICgkcmVxdWVzdC0+aGFzRmlsZSgnY292ZXInKSkgew0KICAgICAgICAgICAgICAgICRmaWxlID0gJHJlcXVlc3QtPmZpbGUoJ2NvdmVyJyk7DQogICAgICAgICAgICAgICAgJHBhdGggPSAkdGhpcy0+c3RvcmVGaWxlSW5TdG9yYWdlKCRmaWxlLCAncHVibGljL2F0dGFjaG1lbnRzJyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICRodG1sQ29kZSA9ICcnOw0KICAgICAgICAgICAgJHNjcmFwZWRBc3NldHMgPSBbXTsNCiAgICAgICAgICAgICRpc1NwYU1vZGUgPSBmYWxzZTsNCg0KICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT5oYXMoJ3dlYnNpdGVfdXJsJykgJiYgIWVtcHR5KCRyZXF1ZXN0LT53ZWJzaXRlX3VybCkpIHsNCiAgICAgICAgICAgICAgICAkc2NyYXBlclNlcnZpY2UgPSBuZXcgQ29tcGxldGVXZWJTY3JhcGVyU2VydmljZSgpOw0KICAgICAgICAgICAgICAgICRpc1NwYU1vZGUgPSAkcmVxdWVzdC0+Ym9vbGVhbignaXNfc3BhJywgZmFsc2UpOw0KICAgICAgICAgICAgICAgICRjdXN0b21IdG1sID0gJGlzU3BhTW9kZSA/ICRyZXF1ZXN0LT5pbnB1dCgnc3BhX2h0bWxfY29kZScpIDogbnVsbDsNCg0KICAgICAgICAgICAgICAgICRkb3dubG9hZE9wdGlvbnMgPSBbDQogICAgICAgICAgICAgICAgICAgICdjc3MnID0+ICRyZXF1ZXN0LT5ib29sZWFuKCdkb3dubG9hZF9jc3MnLCB0cnVlKSwNCiAgICAgICAgICAgICAgICAgICAgJ2ltYWdlcycgPT4gJHJlcXVlc3QtPmJvb2xlYW4oJ2Rvd25sb2FkX2ltYWdlcycsIHRydWUpLA0KICAgICAgICAgICAgICAgICAgICAnanMnID0+ICRyZXF1ZXN0LT5ib29sZWFuKCdkb3dubG9hZF9qcycsIHRydWUpLA0KICAgICAgICAgICAgICAgICAgICAnZm9udHMnID0+ICRyZXF1ZXN0LT5ib29sZWFuKCdkb3dubG9hZF9mb250cycsIHRydWUpLA0KICAgICAgICAgICAgICAgICAgICAnanNvbicgPT4gJHJlcXVlc3QtPmJvb2xlYW4oJ2Rvd25sb2FkX2pzb24nLCB0cnVlKSwNCiAgICAgICAgICAgICAgICAgICAgJ290aGVyX2Fzc2V0cycgPT4gJHJlcXVlc3QtPmJvb2xlYW4oJ2Rvd25sb2FkX290aGVyX2Fzc2V0cycsIHRydWUpDQogICAgICAgICAgICAgICAgXTsNCg0KICAgICAgICAgICAgICAgICRzY3JhcGVkRGF0YSA9ICRzY3JhcGVyU2VydmljZS0+c2NyYXBlQ29tcGxldGVXZWJzaXRlKA0KICAgICAgICAgICAgICAgICAgICAkcmVxdWVzdC0+d2Vic2l0ZV91cmwsDQogICAgICAgICAgICAgICAgICAgICRjdXN0b21IdG1sLA0KICAgICAgICAgICAgICAgICAgICAkZG93bmxvYWRPcHRpb25zDQogICAgICAgICAgICAgICAgKTsNCg0KICAgICAgICAgICAgICAgIGlmICgkc2NyYXBlZERhdGFbJ3N0YXR1cyddID09PSAnc3VjY2VzcycpIHsNCiAgICAgICAgICAgICAgICAgICAgJGh0bWxDb2RlID0gJHNjcmFwZWREYXRhWydodG1sJ107DQogICAgICAgICAgICAgICAgICAgICRzY3JhcGVkQXNzZXRzID0gJHNjcmFwZWREYXRhWydhc3NldHMnXTsNCiAgICAgICAgICAgICAgICAgICAgJGlzU3BhTW9kZSA9ICRzY3JhcGVkRGF0YVsnaXNfc3BhX21vZGUnXTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbDQogICAgICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiBfXygnbG9jYWxlLkZhaWxlZCB0byBzY3JhcGUgd2Vic2l0ZScpIC4gJzogJyAuICRzY3JhcGVkRGF0YVsnbWVzc2FnZSddLA0KICAgICAgICAgICAgICAgICAgICAgICAgJ2Vycm9yJyA9PiAkc2NyYXBlZERhdGFbJ21lc3NhZ2UnXQ0KICAgICAgICAgICAgICAgICAgICBdLCA0MDApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgJGh0bWxDb2RlID0gaHRtbF9lbnRpdHlfZGVjb2RlKCRyZXF1ZXN0LT5odG1sX2NvZGUpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkZG9tYWluX2lkID0gbnVsbDsNCiAgICAgICAgICAgIGlmICgkcmVxdWVzdC0+dHlwZSA9PSAnbWFuYWdlZCcpIHsNCiAgICAgICAgICAgICAgICAkZG9tYWluX2lkID0gJHJlcXVlc3QtPmRvbWFpbl9pZDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJG5ld1dlYnNpdGUgPSBQaGlzaGluZ1dlYnNpdGVQYWdlOjpjcmVhdGUoWw0KICAgICAgICAgICAgICAgICduYW1lJyA9PiAkcmVxdWVzdC0+bmFtZSwNCiAgICAgICAgICAgICAgICAnY292ZXInID0+ICRwYXRoID8/IG51bGwsDQogICAgICAgICAgICAgICAgJ3BoaXNoaW5nX2NhdGVnb3J5X2lkJyA9PiAkcmVxdWVzdC0+cGhpc2hpbmdfY2F0ZWdvcnlfaWQsDQogICAgICAgICAgICAgICAgJ2h0bWxfY29kZScgPT4gJGh0bWxDb2RlLA0KICAgICAgICAgICAgICAgICd0eXBlJyA9PiAkcmVxdWVzdC0+dHlwZSwNCiAgICAgICAgICAgICAgICAnd2Vic2l0ZV91cmwnID0+ICRyZXF1ZXN0LT53ZWJzaXRlX3VybCwNCiAgICAgICAgICAgICAgICAnZnJvbV9hZGRyZXNzX25hbWUnID0+ICRyZXF1ZXN0LT5mcm9tX2FkZHJlc3NfbmFtZSwNCiAgICAgICAgICAgICAgICAnZG9tYWluX2lkJyA9PiAkZG9tYWluX2lkLA0KICAgICAgICAgICAgICAgICdzY3JhcGVkX2Fzc2V0cycgPT4ganNvbl9lbmNvZGUoJHNjcmFwZWRBc3NldHMpLA0KICAgICAgICAgICAgICAgICdpc19zcGEnID0+ICRpc1NwYU1vZGUsDQogICAgICAgICAgICAgICAgJ3NwYV9odG1sX2NvZGUnID0+ICRpc1NwYU1vZGUgPyAkcmVxdWVzdC0+c3BhX2h0bWxfY29kZSA6IG51bGwsDQoNCiAgICAgICAgICAgICAgICAnZG93bmxvYWRfY3NzJyA9PiAkcmVxdWVzdC0+Ym9vbGVhbignZG93bmxvYWRfY3NzJywgdHJ1ZSksDQogICAgICAgICAgICAgICAgJ2Rvd25sb2FkX2ltYWdlcycgPT4gJHJlcXVlc3QtPmJvb2xlYW4oJ2Rvd25sb2FkX2ltYWdlcycsIHRydWUpLA0KICAgICAgICAgICAgICAgICdkb3dubG9hZF9qcycgPT4gJHJlcXVlc3QtPmJvb2xlYW4oJ2Rvd25sb2FkX2pzJywgdHJ1ZSksDQogICAgICAgICAgICAgICAgJ2Rvd25sb2FkX2ZvbnRzJyA9PiAkcmVxdWVzdC0+Ym9vbGVhbignZG93bmxvYWRfZm9udHMnLCB0cnVlKSwNCiAgICAgICAgICAgICAgICAnZG93bmxvYWRfanNvbicgPT4gJHJlcXVlc3QtPmJvb2xlYW4oJ2Rvd25sb2FkX2pzb24nLCB0cnVlKSwNCiAgICAgICAgICAgICAgICAnZG93bmxvYWRfb3RoZXJfYXNzZXRzJyA9PiAkcmVxdWVzdC0+Ym9vbGVhbignZG93bmxvYWRfb3RoZXJfYXNzZXRzJywgdHJ1ZSksDQogICAgICAgICAgICBdKTsNCg0KICAgICAgICAgICAgJG1lc3NhZ2UgPSBfXygnV2Vic2l0ZS5BbiBwaGlzaGluZyBXZWJzaXRlIG5hbWUnKSAuICcgIicgLiAoJG5ld1dlYnNpdGUtPm5hbWUgPz8gX18oJ2xvY2FsZS5bTm8gTmFtZV0nKSkgLiAnIiAnIC4gX18oJ3BoaXNoaW5nLndhcyBhZGRlZCBieSB1c2VybmFtZScpIC4gJyAiJyAuIChhdXRoKCktPnVzZXIoKS0+bmFtZSA/PyBfXygnbG9jYWxlLltObyBVc2VyIE5hbWVdJykpIC4gJyIuJzsNCg0KICAgICAgICAgICAgJHNwYUluZGljYXRvciA9ICRpc1NwYU1vZGUgPyAnPHNtYWxsIGNsYXNzPSJ0ZXh0LWluZm8iPjxpIGNsYXNzPSJmYSBmYS1jb2RlIj48L2k+IFNQQSBNb2RlPC9zbWFsbD48YnI+JyA6ICcnOw0KICAgICAgICAgICAgJGFzc2V0c0luZGljYXRvciA9ICcnOw0KDQogICAgICAgICAgICBpZiAoIWVtcHR5KCRzY3JhcGVkQXNzZXRzKSkgew0KICAgICAgICAgICAgICAgICRhc3NldFR5cGVzID0gW107DQogICAgICAgICAgICAgICAgZm9yZWFjaCAoJHNjcmFwZWRBc3NldHMgYXMgJGFzc2V0KSB7DQogICAgICAgICAgICAgICAgICAgICR0eXBlID0gJGFzc2V0Wyd0eXBlJ10gPz8gJ3Vua25vd24nOw0KICAgICAgICAgICAgICAgICAgICBpZiAoIWluX2FycmF5KCR0eXBlLCAkYXNzZXRUeXBlcykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRhc3NldFR5cGVzW10gPSAkdHlwZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAkYXNzZXRzSW5kaWNhdG9yID0gJzxzbWFsbCBjbGFzcz0idGV4dC1zdWNjZXNzIj48aSBjbGFzcz0iZmEgZmEtZG93bmxvYWQiPjwvaT4gJyAuDQogICAgICAgICAgICAgICAgICAgIGNvdW50KCRzY3JhcGVkQXNzZXRzKSAuICcgJyAuIF9fKCdsb2NhbGUuQXNzZXRzJykgLiAnICgnIC4NCiAgICAgICAgICAgICAgICAgICAgaW1wbG9kZSgnLCAnLCAkYXNzZXRUeXBlcykgLiAnKTwvc21hbGw+PGJyPic7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICRuZXdXZWJzaXRlVGVtcGxhdGUgPSAnDQogICAgPGRpdiBjbGFzcz0iY29sLXhsLTMgY29sLXNtLTYgeGwtNCB3ZWJzaXRlLWNhcmQiIGRhdGEtaWQ9IicgLiAkbmV3V2Vic2l0ZS0+aWQgLiAnIj4NCiAgICAgICAgPGRpdiBjbGFzcz0iY2FyZCI+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9kdWN0LWJveCI+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvZHVjdC1pbWciPg0KICAgICAgICAgICAgICAgICAgICA8aW1nIGNsYXNzPSJpbWctZmx1aWQiIHNyYz0iJyAuIGFzc2V0KCRuZXdXZWJzaXRlLT5jb3ZlcikgLiAnIiBhbHQ9IiI+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb2R1Y3QtaG92ZXIiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHVsPic7DQoNCiAgICAgICAgICAgIGlmIChhdXRoKCktPnVzZXIoKS0+aGFzUGVybWlzc2lvbignd2Vic2l0ZS50cmFzaCcpKSB7DQogICAgICAgICAgICAgICAgJG5ld1dlYnNpdGVUZW1wbGF0ZSAuPSAnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBjbGFzcz0ic2hvdy1mcmFtZSB0cmFzaC13ZWJzaXRlIiBkYXRhLWJzLXRvZ2dsZT0idG9vbHRpcCIgZGF0YS1icy1wbGFjZW1lbnQ9InRvcCIgdGl0bGU9IicgLiBfXygnbG9jYWxlLkRlbGV0ZScpIC4gJyIgZGF0YS1pZD0iJyAuICRuZXdXZWJzaXRlLT5pZCAuICciPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9Imljb24tdHJhc2giPjwvaT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9hPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGk+JzsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uKCd3ZWJzaXRlLmVkaXQnKSkgew0KICAgICAgICAgICAgICAgICRuZXdXZWJzaXRlVGVtcGxhdGUgLj0gJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgY2xhc3M9InNob3ctZnJhbWUgZWRpdC13ZWJzaXRlIiBkYXRhLWJzLXRvZ2dsZT0idG9vbHRpcCIgZGF0YS1icy1wbGFjZW1lbnQ9InRvcCIgdGl0bGU9IicgLiBfXygnbG9jYWxlLkVkaXQnKSAuICciIGRhdGEtaWQ9IicgLiAkbmV3V2Vic2l0ZS0+aWQgLiAnIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJpY29uLXBlbmNpbC1hbHQiPjwvaT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9hPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGk+JzsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uKCd3ZWJzaXRlLnZpZXcnKSkgew0KICAgICAgICAgICAgICAgICRuZXdXZWJzaXRlVGVtcGxhdGUgLj0gJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgY2xhc3M9InNob3ctZnJhbWUgdmlldy13ZWJzaXRlIiBkYXRhLWJzLXRvZ2dsZT0idG9vbHRpcCIgZGF0YS1icy1wbGFjZW1lbnQ9InRvcCIgdGl0bGU9IicgLiBfXygnbG9jYWxlLlZpZXcnKSAuICciIGRhdGEtaWQ9IicgLiAkbmV3V2Vic2l0ZS0+aWQgLiAnIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJpY29uLWV5ZSI+PC9pPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9saT4nOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb24oJ3dlYnNpdGUuY29weScpKSB7DQogICAgICAgICAgICAgICAgJG5ld1dlYnNpdGVUZW1wbGF0ZSAuPSAnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBjbGFzcz0ic2hvdy1mcmFtZSBjb3B5LXdlYnNpdGUiIGRhdGEtYnMtdG9nZ2xlPSJ0b29sdGlwIiBkYXRhLWJzLXBsYWNlbWVudD0idG9wIiB0aXRsZT0iJyAuIF9fKCdsb2NhbGUuQ29weScpIC4gJyIgZGF0YS1pZD0iJyAuICRuZXdXZWJzaXRlLT5pZCAuICciPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9Imljb24tY29weSI+PC9pPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9saT4nOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkbmV3V2Vic2l0ZVRlbXBsYXRlIC49ICcNCiAgICAgICAgICAgICAgICAgICAgICAgIDwvdWw+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb2R1Y3QtZGV0YWlscyI+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb2R1Y3QtbmFtZSI+DQogICAgICAgICAgICAgICAgICAgICAgICA8aDY+JyAuICRzcGFJbmRpY2F0b3IgLiAkbmV3V2Vic2l0ZS0+bmFtZSAuICc8L2g2Pg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvZHVjdC1wcmljZSI+DQogICAgICAgICAgICAgICAgICAgICAgICA8c21hbGwgY2xhc3M9InRleHQtbXV0ZWQiPicgLiBfXygnbG9jYWxlLkNhdGVnb3J5JykgLiAnOiAnIC4gKCRuZXdXZWJzaXRlLT5waGlzaGluZ0NhdGVnb3J5LT5uYW1lID8/ICdOL0EnKSAuICc8L3NtYWxsPjxicj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxzbWFsbCBjbGFzcz0idGV4dC1tdXRlZCI+JyAuIF9fKCdsb2NhbGUuVHlwZScpIC4gJzogJyAuIHVjZmlyc3QoJG5ld1dlYnNpdGUtPnR5cGUpIC4gJzwvc21hbGw+PGJyPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHNtYWxsIGNsYXNzPSJ0ZXh0LW11dGVkIj4nIC4gX18oJ2xvY2FsZS5DcmVhdGVkJykgLiAnOiAnIC4gJG5ld1dlYnNpdGUtPmNyZWF0ZWRfYXQtPmRpZmZGb3JIdW1hbnMoKSAuICc8L3NtYWxsPjxicj4nIC4NCiAgICAgICAgICAgICAgICAkYXNzZXRzSW5kaWNhdG9yOw0KDQogICAgICAgICAgICBpZiAoJGlzU3BhTW9kZSkgew0KICAgICAgICAgICAgICAgICRuZXdXZWJzaXRlVGVtcGxhdGUgLj0gJzxzbWFsbCBjbGFzcz0idGV4dC1wcmltYXJ5Ij48aSBjbGFzcz0iZmEgZmEtbWFnaWMiPjwvaT4gJyAuIF9fKCdsb2NhbGUuU2luZ2xlIFBhZ2UgQXBwbGljYXRpb24nKSAuICc8L3NtYWxsPic7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICRuZXdXZWJzaXRlVGVtcGxhdGUgLj0gJw0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICA8L2Rpdj4NCiAgICA8L2Rpdj4nOw0KDQogICAgICAgICAgICBEQjo6Y29tbWl0KCk7DQoNCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsNCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiB0cnVlLA0KICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiBfXygnV2Vic2l0ZS5XZWJzaXRlIEFkZGVkIFN1Y2Nlc3NmdWxseScpLA0KICAgICAgICAgICAgICAgICd3ZWJzaXRlX3RlbXBsYXRlJyA9PiAkbmV3V2Vic2l0ZVRlbXBsYXRlLA0KICAgICAgICAgICAgICAgICd3ZWJzaXRlX2RhdGEnID0+IFsNCiAgICAgICAgICAgICAgICAgICAgJ2lkJyA9PiAkbmV3V2Vic2l0ZS0+aWQsDQogICAgICAgICAgICAgICAgICAgICduYW1lJyA9PiAkbmV3V2Vic2l0ZS0+bmFtZSwNCiAgICAgICAgICAgICAgICAgICAgJ2lzX3NwYScgPT4gJGlzU3BhTW9kZSwNCiAgICAgICAgICAgICAgICAgICAgJ2Fzc2V0c19jb3VudCcgPT4gY291bnQoJHNjcmFwZWRBc3NldHMpLA0KICAgICAgICAgICAgICAgICAgICAnYXNzZXRfdHlwZXMnID0+IGFycmF5X3VuaXF1ZShhcnJheV9jb2x1bW4oJHNjcmFwZWRBc3NldHMsICd0eXBlJykpLA0KICAgICAgICAgICAgICAgICAgICAnY3JlYXRlZF9hdCcgPT4gJG5ld1dlYnNpdGUtPmNyZWF0ZWRfYXQtPmRpZmZGb3JIdW1hbnMoKSwNCiAgICAgICAgICAgICAgICAgICAgJ2Rvd25sb2FkX3N1bW1hcnknID0+IFsNCiAgICAgICAgICAgICAgICAgICAgICAgICd0b3RhbF9hc3NldHMnID0+IGNvdW50KCRzY3JhcGVkQXNzZXRzKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICdhc3NldF9icmVha2Rvd24nID0+IGFycmF5X2NvdW50X3ZhbHVlcyhhcnJheV9jb2x1bW4oJHNjcmFwZWRBc3NldHMsICd0eXBlJykpDQogICAgICAgICAgICAgICAgICAgIF0NCiAgICAgICAgICAgICAgICBdDQogICAgICAgICAgICBdLCAyMDEpOw0KICAgICAgICB9IGNhdGNoIChcRXhjZXB0aW9uICRlKSB7DQogICAgICAgICAgICBEQjo6cm9sbEJhY2soKTsNCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsNCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwNCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gX18oJ2xvY2FsZS5Tb21ldGhpbmcgd2VudCB3cm9uZycpIC4gJzogJyAuICRlLT5nZXRNZXNzYWdlKCksDQogICAgICAgICAgICAgICAgJ2Vycm9yJyA9PiAkZS0+Z2V0TWVzc2FnZSgpDQogICAgICAgICAgICBdLCA1MDApOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIGZ1bmN0aW9uIGVkaXQoJGlkKQ0KICAgIHsNCiAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICR3ZWJzaXRlID0gUGhpc2hpbmdXZWJzaXRlUGFnZTo6d2l0aChbJ3BoaXNoaW5nQ2F0ZWdvcnknLCAnZG9tYWluJ10pLT5maW5kKCRpZCk7DQoNCiAgICAgICAgICAgIGlmICghJHdlYnNpdGUpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbDQogICAgICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gX18oJ2xvY2FsZS5FcnJvciA0MDQnKSwNCiAgICAgICAgICAgICAgICBdLCA0MDQpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkd2Vic2l0ZURhdGEgPSBbDQogICAgICAgICAgICAgICAgJ2lkJyA9PiAkd2Vic2l0ZS0+aWQsDQogICAgICAgICAgICAgICAgJ25hbWUnID0+ICR3ZWJzaXRlLT5uYW1lLA0KICAgICAgICAgICAgICAgICdwaGlzaGluZ19jYXRlZ29yeV9pZCcgPT4gJHdlYnNpdGUtPnBoaXNoaW5nX2NhdGVnb3J5X2lkLA0KICAgICAgICAgICAgICAgICdmcm9tX2FkZHJlc3NfbmFtZScgPT4gJHdlYnNpdGUtPmZyb21fYWRkcmVzc19uYW1lLA0KICAgICAgICAgICAgICAgICd3ZWJzaXRlX3VybCcgPT4gJHdlYnNpdGUtPndlYnNpdGVfdXJsLA0KICAgICAgICAgICAgICAgICdodG1sX2NvZGUnID0+ICR3ZWJzaXRlLT5odG1sX2NvZGUsDQogICAgICAgICAgICAgICAgJ3R5cGUnID0+ICR3ZWJzaXRlLT50eXBlLA0KICAgICAgICAgICAgICAgICdkb21haW5faWQnID0+ICR3ZWJzaXRlLT5kb21haW5faWQsDQogICAgICAgICAgICAgICAgJ2NvdmVyJyA9PiAkd2Vic2l0ZS0+Y292ZXIgPyBhc3NldCgnc3RvcmFnZS8nIC4gJHdlYnNpdGUtPmNvdmVyKSA6IG51bGwsDQogICAgICAgICAgICAgICAgJ2lzX3NwYScgPT4gJHdlYnNpdGUtPmlzX3NwYSwNCiAgICAgICAgICAgICAgICAnc3BhX2h0bWxfY29kZScgPT4gJHdlYnNpdGUtPnNwYV9odG1sX2NvZGUsDQogICAgICAgICAgICAgICAgJ3NjcmFwZWRfYXNzZXRzJyA9PiBqc29uX2RlY29kZSgkd2Vic2l0ZS0+c2NyYXBlZF9hc3NldHMsIHRydWUpID8/IFtdLA0KICAgICAgICAgICAgICAgICdjcmVhdGVkX2F0JyA9PiAkd2Vic2l0ZS0+Y3JlYXRlZF9hdCwNCiAgICAgICAgICAgICAgICAndXBkYXRlZF9hdCcgPT4gJHdlYnNpdGUtPnVwZGF0ZWRfYXQsDQogICAgICAgICAgICAgICAgJ2NhdGVnb3J5X25hbWUnID0+ICR3ZWJzaXRlLT5jYXRlZ29yeS0+bmFtZSA/PyBudWxsLA0KICAgICAgICAgICAgICAgICdkb21haW5fbmFtZScgPT4gJHdlYnNpdGUtPmRvbWFpbi0+bmFtZSA/PyBudWxsLA0KDQogICAgICAgICAgICAgICAgJ2Rvd25sb2FkX2NzcycgPT4gJHdlYnNpdGUtPmRvd25sb2FkX2NzcyA/PyB0cnVlLA0KICAgICAgICAgICAgICAgICdkb3dubG9hZF9pbWFnZXMnID0+ICR3ZWJzaXRlLT5kb3dubG9hZF9pbWFnZXMgPz8gdHJ1ZSwNCiAgICAgICAgICAgICAgICAnZG93bmxvYWRfanMnID0+ICR3ZWJzaXRlLT5kb3dubG9hZF9qcyA/PyB0cnVlLA0KICAgICAgICAgICAgICAgICdkb3dubG9hZF9mb250cycgPT4gJHdlYnNpdGUtPmRvd25sb2FkX2ZvbnRzID8/IHRydWUsDQogICAgICAgICAgICAgICAgJ2Rvd25sb2FkX2pzb24nID0+ICR3ZWJzaXRlLT5kb3dubG9hZF9qc29uID8/IHRydWUsDQogICAgICAgICAgICAgICAgJ2Rvd25sb2FkX290aGVyX2Fzc2V0cycgPT4gJHdlYnNpdGUtPmRvd25sb2FkX290aGVyX2Fzc2V0cyA/PyB0cnVlLA0KICAgICAgICAgICAgXTsNCg0KICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oJHdlYnNpdGVEYXRhKTsNCiAgICAgICAgfSBjYXRjaCAoXEV4Y2VwdGlvbiAkZSkgew0KDQogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbDQogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gZmFsc2UsDQogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+IF9fKCdsb2NhbGUuU29tZXRoaW5nIHdlbnQgd3JvbmcnKSAuICc6ICcgLiAkZS0+Z2V0TWVzc2FnZSgpLA0KICAgICAgICAgICAgXSwgNTAwKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiB1cGRhdGUoJGlkLCBSZXF1ZXN0ICRyZXF1ZXN0KQ0KICAgIHsNCiAgICAgICAgJHdlYnNpdGUgPSBQaGlzaGluZ1dlYnNpdGVQYWdlOjpmaW5kKCRpZCk7DQoNCiAgICAgICAgaWYgKCEkd2Vic2l0ZSkgew0KICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWw0KICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IGZhbHNlLA0KICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiBfXygnbG9jYWxlLkVycm9yIDQwNCcpLA0KICAgICAgICAgICAgXSwgNDA0KTsNCiAgICAgICAgfQ0KDQogICAgICAgICR2YWxpZGF0b3IgPSBWYWxpZGF0b3I6Om1ha2UoJHJlcXVlc3QtPmFsbCgpLCBbDQogICAgICAgICAgICAnY292ZXInID0+IFsnbnVsbGFibGUnLCAnaW1hZ2UnLCAnbWltZXM6anBnLGpwZWcscG5nJywgJ21heDoyMDQ4J10sDQogICAgICAgICAgICAncGhpc2hpbmdfY2F0ZWdvcnlfaWQnID0+IFsncmVxdWlyZWQnXSwNCiAgICAgICAgICAgICdodG1sX2NvZGUnID0+ICdyZXF1aXJlZF93aXRob3V0OndlYnNpdGVfdXJsJywNCiAgICAgICAgICAgICd3ZWJzaXRlX3VybCcgPT4gJ3JlcXVpcmVkX3dpdGhvdXQ6aHRtbF9jb2RlJywNCiAgICAgICAgICAgICdzcGFfaHRtbF9jb2RlJyA9PiAnbnVsbGFibGV8c3RyaW5nJywNCiAgICAgICAgICAgICdpc19zcGEnID0+ICdudWxsYWJsZXxib29sZWFuJywNCiAgICAgICAgICAgICd0eXBlJyA9PiAncmVxdWlyZWQnLA0KICAgICAgICAgICAgJ2Zyb21fYWRkcmVzc19uYW1lJyA9PiAncmVxdWlyZWR8c3RyaW5nfG1heDoxMDAnLA0KICAgICAgICAgICAgJ2RvbWFpbl9pZCcgPT4gJ3JlcXVpcmVkX2lmOnR5cGUsbWFuYWdlZCcsDQogICAgICAgICAgICAnZG93bmxvYWRfY3NzJyA9PiAnbnVsbGFibGV8Ym9vbGVhbicsDQogICAgICAgICAgICAnZG93bmxvYWRfaW1hZ2VzJyA9PiAnbnVsbGFibGV8Ym9vbGVhbicsDQogICAgICAgICAgICAnZG93bmxvYWRfanMnID0+ICdudWxsYWJsZXxib29sZWFuJywNCiAgICAgICAgICAgICdkb3dubG9hZF9mb250cycgPT4gJ251bGxhYmxlfGJvb2xlYW4nLA0KICAgICAgICAgICAgJ2Rvd25sb2FkX2pzb24nID0+ICdudWxsYWJsZXxib29sZWFuJywNCiAgICAgICAgICAgICdkb3dubG9hZF9vdGhlcl9hc3NldHMnID0+ICdudWxsYWJsZXxib29sZWFuJywNCiAgICAgICAgXSk7DQoNCiAgICAgICAgaWYgKCRyZXF1ZXN0LT50eXBlID09ICdvd24nKSB7DQogICAgICAgICAgICAkcmVxdWVzdC0+dmFsaWRhdGUoWw0KICAgICAgICAgICAgICAgICduYW1lJyA9PiBbJ3JlcXVpcmVkJywgJ21heDoyMDAnLCBSdWxlOjp1bmlxdWUoJ3BoaXNoaW5nX3dlYnNpdGVfcGFnZXMnLCAnbmFtZScpLT5pZ25vcmUoJGlkKV0sDQogICAgICAgICAgICAgICAgJ2Zyb21fYWRkcmVzc19uYW1lJyA9PiAnZW1haWwnDQogICAgICAgICAgICBdKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRyZXF1ZXN0LT52YWxpZGF0ZShbDQogICAgICAgICAgICAgICAgJ2Zyb21fYWRkcmVzc19uYW1lJyA9PiBbDQogICAgICAgICAgICAgICAgICAgICdyZWdleDovXlteQF0rJC8nDQogICAgICAgICAgICAgICAgXSwNCiAgICAgICAgICAgICAgICAnbmFtZScgPT4gWw0KICAgICAgICAgICAgICAgICAgICAncmVxdWlyZWQnLA0KICAgICAgICAgICAgICAgICAgICAnbWF4OjIwMCcsDQogICAgICAgICAgICAgICAgICAgIFJ1bGU6OnVuaXF1ZSgncGhpc2hpbmdfd2Vic2l0ZV9wYWdlcycsICduYW1lJyktPndoZXJlKGZ1bmN0aW9uICgkcXVlcnkpIHVzZSAoJHJlcXVlc3QpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkcXVlcnktPndoZXJlKCdkb21haW5faWQnLCAkcmVxdWVzdC0+ZG9tYWluX2lkKTsNCiAgICAgICAgICAgICAgICAgICAgfSktPmlnbm9yZSgkaWQpLA0KICAgICAgICAgICAgICAgIF0sDQogICAgICAgICAgICBdKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICgkdmFsaWRhdG9yLT5mYWlscygpKSB7DQogICAgICAgICAgICAkZXJyb3JzID0gJHZhbGlkYXRvci0+ZXJyb3JzKCktPnRvQXJyYXkoKTsNCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsNCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwNCiAgICAgICAgICAgICAgICAnZXJyb3JzJyA9PiAkZXJyb3JzLA0KICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiBfXygnbG9jYWxlLlRoZXJlV2FzQVByb2JsZW1VcGRhdGluZ1RoZXdlYnNpdGUnKSAuICI8YnI+IiAuIF9fKCdsb2NhbGUuVmFsaWRhdGlvbiBlcnJvcicpLA0KICAgICAgICAgICAgXSwgNDIyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIERCOjpiZWdpblRyYW5zYWN0aW9uKCk7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICAkY292ZXJQYXRoID0gJHdlYnNpdGUtPmNvdmVyOw0KICAgICAgICAgICAgaWYgKCRyZXF1ZXN0LT5oYXNGaWxlKCdjb3ZlcicpKSB7DQogICAgICAgICAgICAgICAgaWYgKCR3ZWJzaXRlLT5jb3ZlciAmJiBTdG9yYWdlOjpleGlzdHMoJHdlYnNpdGUtPmNvdmVyKSkgew0KICAgICAgICAgICAgICAgICAgICBTdG9yYWdlOjpkZWxldGUoJHdlYnNpdGUtPmNvdmVyKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAkZmlsZSA9ICRyZXF1ZXN0LT5maWxlKCdjb3ZlcicpOw0KICAgICAgICAgICAgICAgICRjb3ZlclBhdGggPSAkdGhpcy0+c3RvcmVGaWxlSW5TdG9yYWdlKCRmaWxlLCAncHVibGljL2F0dGFjaG1lbnRzJyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICRodG1sQ29kZSA9ICcnOw0KICAgICAgICAgICAgJHNjcmFwZWRBc3NldHMgPSBqc29uX2RlY29kZSgkd2Vic2l0ZS0+c2NyYXBlZF9hc3NldHMsIHRydWUpID8/IFtdOw0KICAgICAgICAgICAgJGlzU3BhTW9kZSA9IGZhbHNlOw0KICAgICAgICAgICAgJG5lZWRzUmVzY3JhcGluZyA9IGZhbHNlOw0KDQogICAgICAgICAgICBpZiAoJHJlcXVlc3QtPmhhcygnd2Vic2l0ZV91cmwnKSAmJiAhZW1wdHkoJHJlcXVlc3QtPndlYnNpdGVfdXJsKSkgew0KICAgICAgICAgICAgICAgICRvbGRVcmwgPSAkd2Vic2l0ZS0+d2Vic2l0ZV91cmw7DQogICAgICAgICAgICAgICAgJG5ld1VybCA9ICRyZXF1ZXN0LT53ZWJzaXRlX3VybDsNCiAgICAgICAgICAgICAgICAkb2xkU3BhTW9kZSA9ICR3ZWJzaXRlLT5pc19zcGE7DQogICAgICAgICAgICAgICAgJG5ld1NwYU1vZGUgPSAkcmVxdWVzdC0+Ym9vbGVhbignaXNfc3BhJywgZmFsc2UpOw0KICAgICAgICAgICAgICAgICRvbGRTcGFIdG1sID0gJHdlYnNpdGUtPnNwYV9odG1sX2NvZGU7DQogICAgICAgICAgICAgICAgJG5ld1NwYUh0bWwgPSAkcmVxdWVzdC0+aW5wdXQoJ3NwYV9odG1sX2NvZGUnKTsNCg0KICAgICAgICAgICAgICAgICRvbGREb3dubG9hZE9wdGlvbnMgPSBbDQogICAgICAgICAgICAgICAgICAgICdjc3MnID0+ICR3ZWJzaXRlLT5kb3dubG9hZF9jc3MsDQogICAgICAgICAgICAgICAgICAgICdpbWFnZXMnID0+ICR3ZWJzaXRlLT5kb3dubG9hZF9pbWFnZXMsDQogICAgICAgICAgICAgICAgICAgICdqcycgPT4gJHdlYnNpdGUtPmRvd25sb2FkX2pzLA0KICAgICAgICAgICAgICAgICAgICAnZm9udHMnID0+ICR3ZWJzaXRlLT5kb3dubG9hZF9mb250cywNCiAgICAgICAgICAgICAgICAgICAgJ2pzb24nID0+ICR3ZWJzaXRlLT5kb3dubG9hZF9qc29uLA0KICAgICAgICAgICAgICAgICAgICAnb3RoZXJfYXNzZXRzJyA9PiAkd2Vic2l0ZS0+ZG93bmxvYWRfb3RoZXJfYXNzZXRzLA0KICAgICAgICAgICAgICAgIF07DQoNCiAgICAgICAgICAgICAgICAkbmV3RG93bmxvYWRPcHRpb25zID0gWw0KICAgICAgICAgICAgICAgICAgICAnY3NzJyA9PiAkcmVxdWVzdC0+Ym9vbGVhbignZG93bmxvYWRfY3NzJywgdHJ1ZSksDQogICAgICAgICAgICAgICAgICAgICdpbWFnZXMnID0+ICRyZXF1ZXN0LT5ib29sZWFuKCdkb3dubG9hZF9pbWFnZXMnLCB0cnVlKSwNCiAgICAgICAgICAgICAgICAgICAgJ2pzJyA9PiAkcmVxdWVzdC0+Ym9vbGVhbignZG93bmxvYWRfanMnLCB0cnVlKSwNCiAgICAgICAgICAgICAgICAgICAgJ2ZvbnRzJyA9PiAkcmVxdWVzdC0+Ym9vbGVhbignZG93bmxvYWRfZm9udHMnLCB0cnVlKSwNCiAgICAgICAgICAgICAgICAgICAgJ2pzb24nID0+ICRyZXF1ZXN0LT5ib29sZWFuKCdkb3dubG9hZF9qc29uJywgdHJ1ZSksDQogICAgICAgICAgICAgICAgICAgICdvdGhlcl9hc3NldHMnID0+ICRyZXF1ZXN0LT5ib29sZWFuKCdkb3dubG9hZF9vdGhlcl9hc3NldHMnLCB0cnVlKSwNCiAgICAgICAgICAgICAgICBdOw0KDQogICAgICAgICAgICAgICAgJG5lZWRzUmVzY3JhcGluZyA9ICgNCiAgICAgICAgICAgICAgICAgICAgJG9sZFVybCAhPT0gJG5ld1VybCB8fA0KICAgICAgICAgICAgICAgICAgICAkb2xkU3BhTW9kZSAhPT0gJG5ld1NwYU1vZGUgfHwNCiAgICAgICAgICAgICAgICAgICAgKCRuZXdTcGFNb2RlICYmICRvbGRTcGFIdG1sICE9PSAkbmV3U3BhSHRtbCkgfHwNCiAgICAgICAgICAgICAgICAgICAgJG9sZERvd25sb2FkT3B0aW9ucyAhPT0gJG5ld0Rvd25sb2FkT3B0aW9ucw0KICAgICAgICAgICAgICAgICk7DQoNCiAgICAgICAgICAgICAgICBpZiAoJG5lZWRzUmVzY3JhcGluZykgew0KICAgICAgICAgICAgICAgICAgICAkdGhpcy0+ZGVsZXRlT2xkQXNzZXRzKCRzY3JhcGVkQXNzZXRzKTsNCiAgICAgICAgICAgICAgICAgICAgJHNjcmFwZXJTZXJ2aWNlID0gbmV3IENvbXBsZXRlV2ViU2NyYXBlclNlcnZpY2UoKTsNCiAgICAgICAgICAgICAgICAgICAgJGlzU3BhTW9kZSA9ICRuZXdTcGFNb2RlOw0KICAgICAgICAgICAgICAgICAgICAkY3VzdG9tSHRtbCA9ICRpc1NwYU1vZGUgPyAkbmV3U3BhSHRtbCA6IG51bGw7DQogICAgICAgICAgICAgICAgICAgICRzY3JhcGVkRGF0YSA9ICRzY3JhcGVyU2VydmljZS0+c2NyYXBlQ29tcGxldGVXZWJzaXRlKA0KICAgICAgICAgICAgICAgICAgICAgICAgJG5ld1VybCwNCiAgICAgICAgICAgICAgICAgICAgICAgICRjdXN0b21IdG1sLA0KICAgICAgICAgICAgICAgICAgICAgICAgJG5ld0Rvd25sb2FkT3B0aW9ucw0KICAgICAgICAgICAgICAgICAgICApOw0KDQogICAgICAgICAgICAgICAgICAgIGlmICgkc2NyYXBlZERhdGFbJ3N0YXR1cyddID09PSAnc3VjY2VzcycpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRodG1sQ29kZSA9ICRzY3JhcGVkRGF0YVsnaHRtbCddOw0KICAgICAgICAgICAgICAgICAgICAgICAgJHNjcmFwZWRBc3NldHMgPSAkc2NyYXBlZERhdGFbJ2Fzc2V0cyddOw0KICAgICAgICAgICAgICAgICAgICAgICAgJGlzU3BhTW9kZSA9ICRzY3JhcGVkRGF0YVsnaXNfc3BhX21vZGUnXTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gX18oJ2xvY2FsZS5GYWlsZWQgdG8gc2NyYXBlIHdlYnNpdGUnKSAuICc6ICcgLiAkc2NyYXBlZERhdGFbJ21lc3NhZ2UnXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZXJyb3InID0+ICRzY3JhcGVkRGF0YVsnbWVzc2FnZSddDQogICAgICAgICAgICAgICAgICAgICAgICBdLCA0MDApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJGh0bWxDb2RlID0gJHdlYnNpdGUtPmh0bWxfY29kZTsNCiAgICAgICAgICAgICAgICAgICAgJGlzU3BhTW9kZSA9ICR3ZWJzaXRlLT5pc19zcGE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAkaHRtbENvZGUgPSBodG1sX2VudGl0eV9kZWNvZGUoJHJlcXVlc3QtPnVwZGF0ZWRfaHRtbF9jb2RlID8/ICRyZXF1ZXN0LT5odG1sX2NvZGUpOw0KICAgICAgICAgICAgICAgICRpc1NwYU1vZGUgPSAkcmVxdWVzdC0+Ym9vbGVhbignaXNfc3BhJywgZmFsc2UpOw0KICAgICAgICAgICAgICAgIGlmICgkd2Vic2l0ZS0+aHRtbF9jb2RlICE9PSAkaHRtbENvZGUpIHsNCiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmRlbGV0ZU9sZEFzc2V0cygkc2NyYXBlZEFzc2V0cyk7DQogICAgICAgICAgICAgICAgICAgICRzY3JhcGVkQXNzZXRzID0gW107DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkZG9tYWluX2lkID0gbnVsbDsNCiAgICAgICAgICAgIGlmICgkcmVxdWVzdC0+dHlwZSA9PSAnbWFuYWdlZCcpIHsNCiAgICAgICAgICAgICAgICAkZG9tYWluX2lkID0gJHJlcXVlc3QtPmRvbWFpbl9pZDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJHdlYnNpdGUtPnVwZGF0ZShbDQogICAgICAgICAgICAgICAgJ25hbWUnID0+ICRyZXF1ZXN0LT5uYW1lLA0KICAgICAgICAgICAgICAgICdjb3ZlcicgPT4gJGNvdmVyUGF0aCwNCiAgICAgICAgICAgICAgICAncGhpc2hpbmdfY2F0ZWdvcnlfaWQnID0+ICRyZXF1ZXN0LT5waGlzaGluZ19jYXRlZ29yeV9pZCwNCiAgICAgICAgICAgICAgICAnaHRtbF9jb2RlJyA9PiAkaHRtbENvZGUsDQogICAgICAgICAgICAgICAgJ3R5cGUnID0+ICRyZXF1ZXN0LT50eXBlLA0KICAgICAgICAgICAgICAgICd3ZWJzaXRlX3VybCcgPT4gJHJlcXVlc3QtPndlYnNpdGVfdXJsLA0KICAgICAgICAgICAgICAgICdmcm9tX2FkZHJlc3NfbmFtZScgPT4gJHJlcXVlc3QtPmZyb21fYWRkcmVzc19uYW1lLA0KICAgICAgICAgICAgICAgICdkb21haW5faWQnID0+ICRkb21haW5faWQsDQogICAgICAgICAgICAgICAgJ3NjcmFwZWRfYXNzZXRzJyA9PiBqc29uX2VuY29kZSgkc2NyYXBlZEFzc2V0cyksDQogICAgICAgICAgICAgICAgJ2lzX3NwYScgPT4gJGlzU3BhTW9kZSwNCiAgICAgICAgICAgICAgICAnc3BhX2h0bWxfY29kZScgPT4gJGlzU3BhTW9kZSA/ICRyZXF1ZXN0LT5zcGFfaHRtbF9jb2RlIDogbnVsbCwNCiAgICAgICAgICAgICAgICAnZG93bmxvYWRfY3NzJyA9PiAkcmVxdWVzdC0+Ym9vbGVhbignZG93bmxvYWRfY3NzJywgdHJ1ZSksDQogICAgICAgICAgICAgICAgJ2Rvd25sb2FkX2ltYWdlcycgPT4gJHJlcXVlc3QtPmJvb2xlYW4oJ2Rvd25sb2FkX2ltYWdlcycsIHRydWUpLA0KICAgICAgICAgICAgICAgICdkb3dubG9hZF9qcycgPT4gJHJlcXVlc3QtPmJvb2xlYW4oJ2Rvd25sb2FkX2pzJywgdHJ1ZSksDQogICAgICAgICAgICAgICAgJ2Rvd25sb2FkX2ZvbnRzJyA9PiAkcmVxdWVzdC0+Ym9vbGVhbignZG93bmxvYWRfZm9udHMnLCB0cnVlKSwNCiAgICAgICAgICAgICAgICAnZG93bmxvYWRfanNvbicgPT4gJHJlcXVlc3QtPmJvb2xlYW4oJ2Rvd25sb2FkX2pzb24nLCB0cnVlKSwNCiAgICAgICAgICAgICAgICAnZG93bmxvYWRfb3RoZXJfYXNzZXRzJyA9PiAkcmVxdWVzdC0+Ym9vbGVhbignZG93bmxvYWRfb3RoZXJfYXNzZXRzJywgdHJ1ZSksDQogICAgICAgICAgICBdKTsNCg0KICAgICAgICAgICAgJG1lc3NhZ2UgPSBfXygnV2Vic2l0ZS5QaGlzaGluZyBXZWJzaXRlJykgLiAnICInIC4gKCR3ZWJzaXRlLT5uYW1lID8/IF9fKCdsb2NhbGUuW05vIE5hbWVdJykpIC4gJyIgJyAuIF9fKCdwaGlzaGluZy53YXMgdXBkYXRlZCBieSB1c2VybmFtZScpIC4gJyAiJyAuIChhdXRoKCktPnVzZXIoKS0+bmFtZSA/PyBfXygnbG9jYWxlLltObyBVc2VyIE5hbWVdJykpIC4gJyIuJzsNCg0KICAgICAgICAgICAgJHVwZGF0ZWRXZWJzaXRlVGVtcGxhdGUgPSAkdGhpcy0+Z2VuZXJhdGVXZWJzaXRlVGVtcGxhdGUoJHdlYnNpdGUsICRpc1NwYU1vZGUsICRzY3JhcGVkQXNzZXRzKTsNCg0KICAgICAgICAgICAgREI6OmNvbW1pdCgpOw0KDQogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbihbDQogICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gdHJ1ZSwNCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gX18oJ2xvY2FsZS53ZWJzaXRlV2FzVXBkYXRlZFN1Y2Nlc3NmdWxseScpLA0KICAgICAgICAgICAgICAgICd3ZWJzaXRlJyA9PiAkd2Vic2l0ZS0+ZnJlc2goKSwNCiAgICAgICAgICAgICAgICAndXBkYXRlZFdlYnNpdGVUZW1wbGF0ZScgPT4gJHVwZGF0ZWRXZWJzaXRlVGVtcGxhdGUsDQogICAgICAgICAgICBdLCAyMDApOw0KICAgICAgICB9IGNhdGNoIChcRXhjZXB0aW9uICRlKSB7DQogICAgICAgICAgICBEQjo6cm9sbEJhY2soKTsNCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsNCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwNCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gX18oJ2xvY2FsZS5Tb21ldGhpbmcgd2VudCB3cm9uZycpIC4gJzogJyAuICRlLT5nZXRNZXNzYWdlKCksDQogICAgICAgICAgICAgICAgJ2Vycm9yJyA9PiAkZS0+Z2V0TWVzc2FnZSgpDQogICAgICAgICAgICBdLCA1MDApOw0KICAgICAgICB9DQogICAgfQ0KDQoNCiAgICBwcml2YXRlIGZ1bmN0aW9uIGRlbGV0ZU9sZEFzc2V0cygkYXNzZXRzKQ0KICAgIHsNCiAgICAgICAgaWYgKGVtcHR5KCRhc3NldHMpIHx8ICFpc19hcnJheSgkYXNzZXRzKSkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQoNCiAgICAgICAgZm9yZWFjaCAoJGFzc2V0cyBhcyAkYXNzZXQpIHsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCRhc3NldFsnbG9jYWxfcGF0aCddKSkgew0KICAgICAgICAgICAgICAgICAgICAkc3RvcmFnZVBhdGggPSBzdHJfcmVwbGFjZSgncHVibGljLycsICcnLCAkYXNzZXRbJ2xvY2FsX3BhdGgnXSk7DQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKFN0b3JhZ2U6OmRpc2soJ3B1YmxpYycpLT5leGlzdHMoJHN0b3JhZ2VQYXRoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgU3RvcmFnZTo6ZGlzaygncHVibGljJyktPmRlbGV0ZSgkc3RvcmFnZVBhdGgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgXExvZzo6aW5mbygnRGVsZXRlZCBvbGQgYXNzZXQ6ICcgLiAkc3RvcmFnZVBhdGgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBjYXRjaCAoXEV4Y2VwdGlvbiAkZSkgew0KICAgICAgICAgICAgICAgIFxMb2c6Ondhcm5pbmcoJ0ZhaWxlZCB0byBkZWxldGUgb2xkIGFzc2V0OiAnIC4gJGUtPmdldE1lc3NhZ2UoKSwgWw0KICAgICAgICAgICAgICAgICAgICAnYXNzZXQnID0+ICRhc3NldA0KICAgICAgICAgICAgICAgIF0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQoNCiAgICBwcml2YXRlIGZ1bmN0aW9uIGdlbmVyYXRlV2Vic2l0ZVRlbXBsYXRlKCR3ZWJzaXRlLCAkaXNTcGFNb2RlLCAkc2NyYXBlZEFzc2V0cykNCiAgICB7DQogICAgICAgICRzcGFJbmRpY2F0b3IgPSAkaXNTcGFNb2RlID8gJzxzbWFsbCBjbGFzcz0idGV4dC1pbmZvIj5TUEEgTW9kZTwvc21hbGw+PGJyPicgOiAnJzsNCg0KICAgICAgICAkdGVtcGxhdGUgPSAnDQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2wteGwtMyBjb2wtc20tNiB4bC00IHdlYnNpdGUtY2FyZCIgZGF0YS1pZD0iJyAuICR3ZWJzaXRlLT5pZCAuICciPg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNhcmQiPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9kdWN0LWJveCI+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9kdWN0LWltZyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGltZyBjbGFzcz0iaW1nLWZsdWlkIiBzcmM9IicgLiBhc3NldCgkd2Vic2l0ZS0+Y292ZXIpIC4gJyIgYWx0PSIiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InByb2R1Y3QtaG92ZXIiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dWw+JzsNCg0KICAgICAgICBpZiAoYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb24oJ3dlYnNpdGUudHJhc2gnKSkgew0KICAgICAgICAgICAgJHRlbXBsYXRlIC49ICcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGk+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGNsYXNzPSJzaG93LWZyYW1lIHRyYXNoLXdlYnNpdGUiIGRhdGEtYnMtdG9nZ2xlPSJ0b29sdGlwIiBkYXRhLWJzLXBsYWNlbWVudD0idG9wIiB0aXRsZT0iJyAuIF9fKCdsb2NhbGUuRGVsZXRlJykgLiAnIiBkYXRhLWlkPSInIC4gJHdlYnNpdGUtPmlkIC4gJyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iaWNvbi10cmFzaCI+PC9pPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9saT4nOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uKCd3ZWJzaXRlLmVkaXQnKSkgew0KICAgICAgICAgICAgJHRlbXBsYXRlIC49ICcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGk+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGNsYXNzPSJzaG93LWZyYW1lIGVkaXQtd2Vic2l0ZSIgZGF0YS1icy10b2dnbGU9InRvb2x0aXAiIGRhdGEtYnMtcGxhY2VtZW50PSJ0b3AiIHRpdGxlPSInIC4gX18oJ2xvY2FsZS5FZGl0JykgLiAnIiBkYXRhLWlkPSInIC4gJHdlYnNpdGUtPmlkIC4gJyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iaWNvbi1wZW5jaWwtYWx0Ij48L2k+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xpPic7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoYXV0aCgpLT51c2VyKCktPmhhc1Blcm1pc3Npb24oJ3dlYnNpdGUudmlldycpKSB7DQogICAgICAgICAgICAkdGVtcGxhdGUgLj0gJw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgY2xhc3M9InNob3ctZnJhbWUgdmlldy13ZWJzaXRlIiBkYXRhLWJzLXRvZ2dsZT0idG9vbHRpcCIgZGF0YS1icy1wbGFjZW1lbnQ9InRvcCIgdGl0bGU9IicgLiBfXygnbG9jYWxlLlZpZXcnKSAuICciIGRhdGEtaWQ9IicgLiAkd2Vic2l0ZS0+aWQgLiAnIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJpY29uLWV5ZSI+PC9pPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9saT4nOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGF1dGgoKS0+dXNlcigpLT5oYXNQZXJtaXNzaW9uKCd3ZWJzaXRlLmNvcHknKSkgew0KICAgICAgICAgICAgJHRlbXBsYXRlIC49ICcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGk+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGNsYXNzPSJzaG93LWZyYW1lIGNvcHktd2Vic2l0ZSIgZGF0YS1icy10b2dnbGU9InRvb2x0aXAiIGRhdGEtYnMtcGxhY2VtZW50PSJ0b3AiIHRpdGxlPSInIC4gX18oJ2xvY2FsZS5Db3B5JykgLiAnIiBkYXRhLWlkPSInIC4gJHdlYnNpdGUtPmlkIC4gJyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iaWNvbi1jb3B5Ij48L2k+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xpPic7DQogICAgICAgIH0NCg0KICAgICAgICAkdGVtcGxhdGUgLj0gJw0KICAgICAgICAgICAgICAgICAgICAgICAgPC91bD4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvZHVjdC1kZXRhaWxzIj4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHJvZHVjdC1uYW1lIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxoNj4nIC4gJHNwYUluZGljYXRvciAuICR3ZWJzaXRlLT5uYW1lIC4gJzwvaDY+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwcm9kdWN0LXByaWNlIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxzbWFsbCBjbGFzcz0idGV4dC1tdXRlZCI+JyAuIF9fKCdsb2NhbGUuQ2F0ZWdvcnknKSAuICc6ICcgLiAoJHdlYnNpdGUtPnBoaXNoaW5nQ2F0ZWdvcnktPm5hbWUgPz8gJ04vQScpIC4gJzwvc21hbGw+PGJyPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHNtYWxsIGNsYXNzPSJ0ZXh0LW11dGVkIj4nIC4gX18oJ2xvY2FsZS5UeXBlJykgLiAnOiAnIC4gdWNmaXJzdCgkd2Vic2l0ZS0+dHlwZSkgLiAnPC9zbWFsbD48YnI+DQogICAgICAgICAgICAgICAgICAgICAgICA8c21hbGwgY2xhc3M9InRleHQtbXV0ZWQiPicgLiBfXygnbG9jYWxlLlVwZGF0ZWQnKSAuICc6ICcgLiAkd2Vic2l0ZS0+dXBkYXRlZF9hdC0+ZGlmZkZvckh1bWFucygpIC4gJzwvc21hbGw+JzsNCg0KICAgICAgICBpZiAoJGlzU3BhTW9kZSkgew0KICAgICAgICAgICAgJHRlbXBsYXRlIC49ICc8YnI+PHNtYWxsIGNsYXNzPSJ0ZXh0LWluZm8iPjxpIGNsYXNzPSJmYSBmYS1jb2RlIj48L2k+IFNQQSBXZWJzaXRlPC9zbWFsbD4nOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCFlbXB0eSgkc2NyYXBlZEFzc2V0cykpIHsNCiAgICAgICAgICAgICRhc3NldENvdW50ID0gY291bnQoJHNjcmFwZWRBc3NldHMpOw0KICAgICAgICAgICAgJHRlbXBsYXRlIC49ICc8YnI+PHNtYWxsIGNsYXNzPSJ0ZXh0LXN1Y2Nlc3MiPjxpIGNsYXNzPSJmYSBmYS1kb3dubG9hZCI+PC9pPiAnIC4gJGFzc2V0Q291bnQgLiAnICcgLiBfXygnbG9jYWxlLkFzc2V0cyBEb3dubG9hZGVkJykgLiAnPC9zbWFsbD4nOw0KICAgICAgICB9DQoNCiAgICAgICAgJHRlbXBsYXRlIC49ICcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgIDwvZGl2Pic7DQoNCiAgICAgICAgcmV0dXJuICR0ZW1wbGF0ZTsNCiAgICB9DQoNCg0KICAgIHB1YmxpYyBmdW5jdGlvbiB0cmFzaCgkd2Vic2l0ZSkNCiAgICB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICAkd2Vic2l0ZSA9IFBoaXNoaW5nV2Vic2l0ZVBhZ2U6OmZpbmRPckZhaWwoJHdlYnNpdGUpOw0KDQogICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgd2Vic2l0ZSBpcyByZWxhdGVkIHRvIGEgZG9tYWluDQogICAgICAgICAgICAvLyBpZiAoJHdlYnNpdGUtPmRvbWFpbigpLT5leGlzdHMoKSkgew0KICAgICAgICAgICAgLy8gICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsNCiAgICAgICAgICAgIC8vICAgICAgICAgJ3N0YXR1cycgPT4gZmFsc2UsDQogICAgICAgICAgICAvLyAgICAgICAgICdtZXNzYWdlJyA9PiBfXygnYXNzZXQuV2Vic2l0ZUNhbm5vdEJlVHJhc2hlZER1ZVRvRG9tYWluUmVsYXRpb24nKSwNCiAgICAgICAgICAgIC8vICAgICBdLCA0MjIpOw0KICAgICAgICAgICAgLy8gfQ0KDQoNCiAgICAgICAgICAgIGlmICgkd2Vic2l0ZS0+bWFpbFRlbXBsYXRlcygpLT5leGlzdHMoKSkgew0KICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKFsNCiAgICAgICAgICAgICAgICAgICAgJ3N0YXR1cycgPT4gZmFsc2UsDQogICAgICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiBfXygnYXNzZXQuV2Vic2l0ZUNhbm5vdEJlRGVsZXRlZER1ZVRvbWFpbFRlbXBsYXRlc1JlbGF0aW9uJyksDQogICAgICAgICAgICAgICAgXSwgNDIyKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gUHJvY2VlZCB3aXRoIHRyYXNoaW5nIHRoZSB3ZWJzaXRlDQogICAgICAgICAgICAkd2Vic2l0ZS0+dXBkYXRlKFsNCiAgICAgICAgICAgICAgICAnZGVsZXRlZF9hdCcgPT4gbm93KCksDQogICAgICAgICAgICBdKTsNCg0KICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWw0KICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IHRydWUsDQogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+IF9fKCdhc3NldC5XZWJzaXRlV2FzVHJhc2hlZFN1Y2Nlc3NmdWxseScpLA0KICAgICAgICAgICAgXSwgMjAwKTsNCiAgICAgICAgfSBjYXRjaCAoXEV4Y2VwdGlvbiAkZSkgew0KICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWw0KICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IGZhbHNlLA0KICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiAkZS0+Z2V0TWVzc2FnZSgpLA0KICAgICAgICAgICAgXSwgNTAwKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiByZXN0b3JlKCRpZCwgUmVxdWVzdCAkcmVxdWVzdCkNCiAgICB7DQogICAgICAgIHRyeSB7DQogICAgICAgICAgICAvLyBVc2Ugd2l0aFRyYXNoZWQoKSB0byBpbmNsdWRlIHNvZnQtZGVsZXRlZCByZWNvcmRzDQogICAgICAgICAgICAkd2Vic2l0ZSA9IFBoaXNoaW5nV2Vic2l0ZVBhZ2U6OndpdGhUcmFzaGVkKCktPmZpbmRPckZhaWwoJGlkKTsNCiAgICAgICAgICAgIC8vIFJlc3RvcmUgdGhlIHNvZnQtZGVsZXRlZCByZWNvcmQNCiAgICAgICAgICAgICR3ZWJzaXRlLT5yZXN0b3JlKCk7DQoNCiAgICAgICAgICAgICRyZXNwb25zZSA9IFsNCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiB0cnVlLA0KICAgICAgICAgICAgICAgICdtZXNzYWdlJyA9PiBfXygncGhpc2hpbmcuV2Vic2l0ZVJlc3RvcmVTdWNjZXNzZnVsbHknKSwNCiAgICAgICAgICAgIF07DQogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UoKS0+anNvbigkcmVzcG9uc2UsIDIwMCk7DQogICAgICAgIH0gY2F0Y2ggKFxFeGNlcHRpb24gJGUpIHsNCiAgICAgICAgICAgICRyZXNwb25zZSA9IFsNCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwNCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gX18oJ2xvY2FsZS5FcnJvcicpLA0KICAgICAgICAgICAgXTsNCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKCRyZXNwb25zZSwgNTAyKTsNCiAgICAgICAgfQ0KICAgIH0NCiAgICBwdWJsaWMgZnVuY3Rpb24gZGVsZXRlKCRpZCkNCiAgICB7DQogICAgICAgICRXZWJzaXRlID0gUGhpc2hpbmdXZWJzaXRlUGFnZTo6d2l0aFRyYXNoZWQoKS0+ZmluZE9yRmFpbCgkaWQpOw0KICAgICAgICBpZiAoJFdlYnNpdGUpIHsNCg0KICAgICAgICAgICAgaWYgKCRXZWJzaXRlLT5tYWlsVGVtcGxhdGVzKCktPmV4aXN0cygpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlKCktPmpzb24oWw0KICAgICAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+IF9fKCdhc3NldC5XZWJzaXRlQ2Fubm90QmVEZWxldGVkRHVlVG9tYWlsVGVtcGxhdGVzUmVsYXRpb24nKSwNCiAgICAgICAgICAgICAgICBdLCA0MjIpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkV2Vic2l0ZS0+Zm9yY2VEZWxldGUoKTsNCiAgICAgICAgICAgICRyZXNwb25zZSA9IGFycmF5KA0KICAgICAgICAgICAgICAgICdzdGF0dXMnID0+IHRydWUsDQogICAgICAgICAgICAgICAgJ21lc3NhZ2UnID0+IF9fKCdwaGlzaGluZy5XZWJzaXRlV2FzRGVsZXRlZFN1Y2Nlc3NmdWxseScpLA0KICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKCRyZXNwb25zZSwgMjAwKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRyZXNwb25zZSA9IFsNCiAgICAgICAgICAgICAgICAnc3RhdHVzJyA9PiBmYWxzZSwNCiAgICAgICAgICAgICAgICAnbWVzc2FnZScgPT4gX18oJ2xvY2FsZS5FcnJvcicpLA0KICAgICAgICAgICAgXTsNCiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSgpLT5qc29uKCRyZXNwb25zZSwgNTAyKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBnZXRBcmNoaXZlZFdlYnNpdGVzKCkNCiAgICB7DQogICAgICAgICRicmVhZGNydW1icyA9IFsNCiAgICAgICAgICAgIFsnbGluaycgPT4gcm91dGUoJ2FkbWluLmRhc2hib2FyZCcpLCAnbmFtZScgPT4gX18oJ2xvY2FsZS5EYXNoYm9hcmQnKV0sDQogICAgICAgICAgICBbJ25hbWUnID0+IF9fKCdwaGlzaGluZy53ZWJzaXRlcycpXQ0KICAgICAgICBdOw0KICAgICAgICAkY2F0ZWdvcmllcyA9IFBoaXNoaW5nQ2F0ZWdvcnk6OmFsbCgpOw0KDQogICAgICAgICRhcmNoaXZlZF93ZWJzaXRlcyA9IFBoaXNoaW5nV2Vic2l0ZVBhZ2U6Om9ubHlUcmFzaGVkKCktPmdldCgpOw0KICAgICAgICByZXR1cm4gdmlldygnYWRtaW4uY29udGVudC5waGlzaGluZy53ZWJzaXRlcy5hcmNoaXZlZCcsIGdldF9kZWZpbmVkX3ZhcnMoKSk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZWFyY2goUmVxdWVzdCAkcmVxdWVzdCkNCiAgICB7DQogICAgICAgICRxdWVyeSA9ICRyZXF1ZXN0LT5pbnB1dCgncXVlcnknKTsNCiAgICAgICAgJHBhcmFtID0gMTsNCiAgICAgICAgLy8gRmV0Y2ggZGF0YSBkaXJlY3RseSBmcm9tIHRoZSBkYXRhYmFzZSB3aXRob3V0IGNhY2hpbmcNCiAgICAgICAgJHdlYnNpdGVzID0gUGhpc2hpbmdXZWJzaXRlUGFnZTo6d2l0aG91dFRyYXNoZWQoKQ0KICAgICAgICAgICAgLT53aGVyZShmdW5jdGlvbiAoJHEpIHVzZSAoJHF1ZXJ5KSB7DQogICAgICAgICAgICAgICAgLy8gU2VhcmNoIHdpdGhpbiBQaGlzaGluZ1dlYnNpdGVQYWdlIG5hbWUNCiAgICAgICAgICAgICAgICAkcS0+d2hlcmUoJ25hbWUnLCAnbGlrZScsICclJyAuICRxdWVyeSAuICclJykNCiAgICAgICAgICAgICAgICAgICAgLy8gU2VhcmNoIHdpdGhpbiByZWxhdGVkIENhdGVnb3J5IG5hbWUNCiAgICAgICAgICAgICAgICAgICAgLT5vcldoZXJlSGFzKCdjYXRlZ29yeScsIGZ1bmN0aW9uICgkcSkgdXNlICgkcXVlcnkpIHsNCiAgICAgICAgICAgICAgICAgICAgJHEtPndoZXJlKCduYW1lJywgJ2xpa2UnLCAnJScgLiAkcXVlcnkgLiAnJScpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIC0+Z2V0KCk7DQoNCiAgICAgICAgLy8gUmV0dXJuIGEgdmlldyB3aXRoIHRoZSBmaWx0ZXJlZCByZXN1bHRzDQogICAgICAgIHJldHVybiB2aWV3KCdhZG1pbi5jb250ZW50LnBoaXNoaW5nLndlYnNpdGVzLnNlYXJjaCcsIFsnd2Vic2l0ZXMnID0+ICR3ZWJzaXRlcywgJ3BhcmFtJyA9PiAkcGFyYW1dKS0+cmVuZGVyKCk7DQogICAgfQ0KICAgIHB1YmxpYyBmdW5jdGlvbiBzZWFyY2hUcmFzaChSZXF1ZXN0ICRyZXF1ZXN0KQ0KICAgIHsNCiAgICAgICAgJHF1ZXJ5ID0gJHJlcXVlc3QtPmlucHV0KCdxdWVyeScpOw0KICAgICAgICAkcGFyYW0gPSAyOw0KDQogICAgICAgIC8vIEZldGNoIGRhdGEgZGlyZWN0bHkgZnJvbSB0aGUgZGF0YWJhc2Ugd2l0aG91dCBjYWNoaW5nDQogICAgICAgICR3ZWJzaXRlcyA9IFBoaXNoaW5nV2Vic2l0ZVBhZ2U6Om9ubHlUcmFzaGVkKCkNCiAgICAgICAgICAgIC0+d2hlcmUoZnVuY3Rpb24gKCRxKSB1c2UgKCRxdWVyeSkgew0KICAgICAgICAgICAgICAgIC8vIFNlYXJjaCB3aXRoaW4gUGhpc2hpbmdXZWJzaXRlUGFnZSBuYW1lDQogICAgICAgICAgICAgICAgJHEtPndoZXJlKCduYW1lJywgJ2xpa2UnLCAnJScgLiAkcXVlcnkgLiAnJScpDQogICAgICAgICAgICAgICAgICAgIC8vIFNlYXJjaCB3aXRoaW4gcmVsYXRlZCBDYXRlZ29yeSBuYW1lDQogICAgICAgICAgICAgICAgICAgIC0+b3JXaGVyZUhhcygnY2F0ZWdvcnknLCBmdW5jdGlvbiAoJHEpIHVzZSAoJHF1ZXJ5KSB7DQogICAgICAgICAgICAgICAgICAgICRxLT53aGVyZSgnbmFtZScsICdsaWtlJywgJyUnIC4gJHF1ZXJ5IC4gJyUnKTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICAtPmdldCgpOw0KDQogICAgICAgIC8vIFJldHVybiBhIHZpZXcgd2l0aCB0aGUgZmlsdGVyZWQgcmVzdWx0cw0KICAgICAgICByZXR1cm4gdmlldygnYWRtaW4uY29udGVudC5waGlzaGluZy53ZWJzaXRlcy5zZWFyY2gnLCBbJ3dlYnNpdGVzJyA9PiAkd2Vic2l0ZXMsICdwYXJhbScgPT4gJHBhcmFtXSktPnJlbmRlcigpOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBzaG93KCRuYW1lLCAkaWQpDQogICAgew0KICAgICAgICAkd2Vic2l0ZSA9IFBoaXNoaW5nV2Vic2l0ZVBhZ2U6OndpdGgoJ2RvbWFpbicpLT5maW5kKCRpZCk7DQogICAgICAgICRkZWNvZGVkTmFtZSA9IHN0cl9yZXBsYWNlKCcrJywgJyAnLCAkbmFtZSk7IC8vIFJlcGxhY2UgJysnIHdpdGggc3BhY2UNCiAgICAgICAgLy8gaWYoJHdlYnNpdGUtPmRvbWFpbigpLT5leGlzdHMoKSl7DQogICAgICAgIC8vICAgICAkc3ViZG9tYWluID0gJHdlYnNpdGUtPmZyb21fYWRkcmVzc19uYW1lOw0KICAgICAgICAvLyAgICAgJGRvbWFpbiA9IGx0cmltKCR3ZWJzaXRlLT5kb21haW4tPm5hbWUsICdAJyk7DQogICAgICAgIC8vICAgICAkZHluYW1pY1VybCA9ICJodHRwOi8veyRzdWJkb21haW59LnskZG9tYWlufS9QV1BJL3skd2Vic2l0ZS0+aWR9P2VtcGxveWVlPTE1JiZtYWlsPTEwIjsNCiAgICAgICAgLy8gfWVsc2V7DQogICAgICAgIC8vICAgICAkZG9tYWluID0gJHdlYnNpdGUtPmZyb21fYWRkcmVzc19uYW1lOw0KICAgICAgICAvLyAgICAgJGR5bmFtaWNVcmwgPSAiaHR0cDovL3skZG9tYWlufS9QV1BJL3skd2Vic2l0ZS0+aWR9P2VtcGxveWVlPTE1JiZtYWlsPTEwIjsNCiAgICAgICAgLy8gfQ0KDQogICAgICAgIC8vIHJldHVybiByZWRpcmVjdCgpLT5hd2F5KCRkeW5hbWljVXJsKTsNCiAgICAgICAgcmV0dXJuIHZpZXcoJ2FkbWluLmNvbnRlbnQucGhpc2hpbmcud2Vic2l0ZXMuc2hvd193ZWJzaXRlJywgY29tcGFjdCgnd2Vic2l0ZScsICdkZWNvZGVkTmFtZScpKTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gdGVzdEFjdGlvbigpDQogICAgew0KICAgICAgICBkZCgnSGVsbG8gRnJvbSBQb3N0ICcpOw0KICAgIH0NCn0NCg==